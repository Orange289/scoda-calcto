!function(e){var t={el:{},init:function(t,o){if(!("object"==typeof o&&o.length>0))return!1;this.el=o;var n,a,r=this,s={},c=t,p=9;ymaps.ready(function(){n=window.map=new ymaps.Map(r.el[0].id,{center:[55.751574,37.573856],zoom:p,controls:[]});var e=ymaps.templateLayoutFactory.createClass('<div style="color: #FFFFFF; position:absolute; width:34px; top:21px; font-size:10px; text-align:center;">$[properties.geoObjects.length]</div>');a=new ymaps.Clusterer({gridSize:100,clusterDisableClickZoom:!1,clusterIconContentLayout:e,clusterIcons:[{href:"img/map-marker-x2.png",size:[34,50],offset:[-17,-25]}]});var t=new Array;for(i in c){var o="";a.add(o=new ymaps.Placemark([c[i].LAT,c[i].LNG],{balloonContentBody:"<strong>"+c[i].NAME+"</strong><br /><span>"+c[i].ADDRESS+'</span><br /><input data-dlr-id="'+c[i].XML_ID+'" type="button" class="btn confirm" value="Подтвердить выбор">'},{iconLayout:"default#image",iconImageHref:"img/map-marker-x2.png",iconImageSize:[23,33],iconImageOffset:[-15,0],hideIconOnBalloonOpen:!1,id:i})),s[i]=o,t.push({type:"Feature",properties:{id:c[i].XML_ID},geometry:{type:"Point",coordinates:[c[i].LAT,c[i].LNG]}})}n.geoObjects.add(a),n.geoObjects.events.add(["balloonopen","balloonclose"],function(e){var t=e.get("target");t.geometry&&"myPoint"!=t.options._options.id&&("balloonopen"===e.get("type")?t.options.set("iconImageHref","img/map-marker-x2.png"):t.options.set("iconImageHref","img/map-marker-x2.png"))})}),e(document).on("mapChangeCity",o,function(e,t){if("object"==typeof t&&"undefined"!=typeof t.cityName){var o=ymaps.geocode(t.cityName);o.then(function(e){if(e.geoObjects.getLength()){var t=e.geoObjects.get(0);n.setCenter(t.geometry.getCoordinates(),p,{checkZoomRange:!0})}},function(e){alert("Возникла ошибка: "+e.message)})}}),e(document).on("click",".confirm",function(){e("body").trigger("ymapDealerChoose",e(this).data("dlr-id")),e.fancybox.close()})}};e.fn.dealersMapInit=function(e){return t.init(e,this),this}}(jQuery);